{"dependencies":[{"name":"./polling.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":39,"index":39}}],"key":"Pl+iaQVK3G0OaUHovkJUbWBEusk=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.Fetch = void 0;\n  var _polling = require(_dependencyMap[0], \"./polling.js\");\n  /**\n   * HTTP long-polling based on the built-in `fetch()` method.\n   *\n   * Usage: browser, Node.js (since v18), Deno, Bun\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch\n   * @see https://caniuse.com/fetch\n   * @see https://nodejs.org/api/globals.html#fetch\n   */\n  class Fetch extends _polling.Polling {\n    doPoll() {\n      this._fetch().then(res => {\n        if (!res.ok) {\n          return this.onError(\"fetch read error\", res.status, res);\n        }\n        res.text().then(data => this.onData(data));\n      }).catch(err => {\n        this.onError(\"fetch read error\", err);\n      });\n    }\n    doWrite(data, callback) {\n      this._fetch(data).then(res => {\n        if (!res.ok) {\n          return this.onError(\"fetch write error\", res.status, res);\n        }\n        callback();\n      }).catch(err => {\n        this.onError(\"fetch write error\", err);\n      });\n    }\n    _fetch(data) {\n      var _a;\n      const isPost = data !== undefined;\n      const headers = new Headers(this.opts.extraHeaders);\n      if (isPost) {\n        headers.set(\"content-type\", \"text/plain;charset=UTF-8\");\n      }\n      (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.appendCookies(headers);\n      return fetch(this.uri(), {\n        method: isPost ? \"POST\" : \"GET\",\n        body: isPost ? data : null,\n        headers,\n        credentials: this.opts.withCredentials ? \"include\" : \"omit\"\n      }).then(res => {\n        var _a;\n        // @ts-ignore getSetCookie() was added in Node.js v19.7.0\n        (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(res.headers.getSetCookie());\n        return res;\n      });\n    }\n  }\n  exports.Fetch = Fetch;\n});","lineCount":59,"map":[[6,2,1,0],[6,6,1,0,"_polling"],[6,14,1,0],[6,17,1,0,"require"],[6,24,1,0],[6,25,1,0,"_dependencyMap"],[6,39,1,0],[7,2,2,0],[8,0,3,0],[9,0,4,0],[10,0,5,0],[11,0,6,0],[12,0,7,0],[13,0,8,0],[14,0,9,0],[15,0,10,0],[16,2,11,7],[16,8,11,13,"Fetch"],[16,13,11,18],[16,22,11,27,"Polling"],[16,38,11,34],[16,39,11,35],[17,4,12,4,"doPoll"],[17,10,12,10,"doPoll"],[17,11,12,10],[17,13,12,13],[18,6,13,8],[18,10,13,12],[18,11,13,13,"_fetch"],[18,17,13,19],[18,18,13,20],[18,19,13,21],[18,20,14,13,"then"],[18,24,14,17],[18,25,14,19,"res"],[18,28,14,22],[18,32,14,27],[19,8,15,12],[19,12,15,16],[19,13,15,17,"res"],[19,16,15,20],[19,17,15,21,"ok"],[19,19,15,23],[19,21,15,25],[20,10,16,16],[20,17,16,23],[20,21,16,27],[20,22,16,28,"onError"],[20,29,16,35],[20,30,16,36],[20,48,16,54],[20,50,16,56,"res"],[20,53,16,59],[20,54,16,60,"status"],[20,60,16,66],[20,62,16,68,"res"],[20,65,16,71],[20,66,16,72],[21,8,17,12],[22,8,18,12,"res"],[22,11,18,15],[22,12,18,16,"text"],[22,16,18,20],[22,17,18,21],[22,18,18,22],[22,19,18,23,"then"],[22,23,18,27],[22,24,18,29,"data"],[22,28,18,33],[22,32,18,38],[22,36,18,42],[22,37,18,43,"onData"],[22,43,18,49],[22,44,18,50,"data"],[22,48,18,54],[22,49,18,55],[22,50,18,56],[23,6,19,8],[23,7,19,9],[23,8,19,10],[23,9,20,13,"catch"],[23,14,20,18],[23,15,20,20,"err"],[23,18,20,23],[23,22,20,28],[24,8,21,12],[24,12,21,16],[24,13,21,17,"onError"],[24,20,21,24],[24,21,21,25],[24,39,21,43],[24,41,21,45,"err"],[24,44,21,48],[24,45,21,49],[25,6,22,8],[25,7,22,9],[25,8,22,10],[26,4,23,4],[27,4,24,4,"doWrite"],[27,11,24,11,"doWrite"],[27,12,24,12,"data"],[27,16,24,16],[27,18,24,18,"callback"],[27,26,24,26],[27,28,24,28],[28,6,25,8],[28,10,25,12],[28,11,25,13,"_fetch"],[28,17,25,19],[28,18,25,20,"data"],[28,22,25,24],[28,23,25,25],[28,24,26,13,"then"],[28,28,26,17],[28,29,26,19,"res"],[28,32,26,22],[28,36,26,27],[29,8,27,12],[29,12,27,16],[29,13,27,17,"res"],[29,16,27,20],[29,17,27,21,"ok"],[29,19,27,23],[29,21,27,25],[30,10,28,16],[30,17,28,23],[30,21,28,27],[30,22,28,28,"onError"],[30,29,28,35],[30,30,28,36],[30,49,28,55],[30,51,28,57,"res"],[30,54,28,60],[30,55,28,61,"status"],[30,61,28,67],[30,63,28,69,"res"],[30,66,28,72],[30,67,28,73],[31,8,29,12],[32,8,30,12,"callback"],[32,16,30,20],[32,17,30,21],[32,18,30,22],[33,6,31,8],[33,7,31,9],[33,8,31,10],[33,9,32,13,"catch"],[33,14,32,18],[33,15,32,20,"err"],[33,18,32,23],[33,22,32,28],[34,8,33,12],[34,12,33,16],[34,13,33,17,"onError"],[34,20,33,24],[34,21,33,25],[34,40,33,44],[34,42,33,46,"err"],[34,45,33,49],[34,46,33,50],[35,6,34,8],[35,7,34,9],[35,8,34,10],[36,4,35,4],[37,4,36,4,"_fetch"],[37,10,36,10,"_fetch"],[37,11,36,11,"data"],[37,15,36,15],[37,17,36,17],[38,6,37,8],[38,10,37,12,"_a"],[38,12,37,14],[39,6,38,8],[39,12,38,14,"isPost"],[39,18,38,20],[39,21,38,23,"data"],[39,25,38,27],[39,30,38,32,"undefined"],[39,39,38,41],[40,6,39,8],[40,12,39,14,"headers"],[40,19,39,21],[40,22,39,24],[40,26,39,28,"Headers"],[40,33,39,35],[40,34,39,36],[40,38,39,40],[40,39,39,41,"opts"],[40,43,39,45],[40,44,39,46,"extraHeaders"],[40,56,39,58],[40,57,39,59],[41,6,40,8],[41,10,40,12,"isPost"],[41,16,40,18],[41,18,40,20],[42,8,41,12,"headers"],[42,15,41,19],[42,16,41,20,"set"],[42,19,41,23],[42,20,41,24],[42,34,41,38],[42,36,41,40],[42,62,41,66],[42,63,41,67],[43,6,42,8],[44,6,43,8],[44,7,43,9,"_a"],[44,9,43,11],[44,12,43,14],[44,16,43,18],[44,17,43,19,"socket"],[44,23,43,25],[44,24,43,26,"_cookieJar"],[44,34,43,36],[44,40,43,42],[44,44,43,46],[44,48,43,50,"_a"],[44,50,43,52],[44,55,43,57],[44,60,43,62],[44,61,43,63],[44,64,43,66],[44,69,43,71],[44,70,43,72],[44,73,43,75,"_a"],[44,75,43,77],[44,76,43,78,"appendCookies"],[44,89,43,91],[44,90,43,92,"headers"],[44,97,43,99],[44,98,43,100],[45,6,44,8],[45,13,44,15,"fetch"],[45,18,44,20],[45,19,44,21],[45,23,44,25],[45,24,44,26,"uri"],[45,27,44,29],[45,28,44,30],[45,29,44,31],[45,31,44,33],[46,8,45,12,"method"],[46,14,45,18],[46,16,45,20,"isPost"],[46,22,45,26],[46,25,45,29],[46,31,45,35],[46,34,45,38],[46,39,45,43],[47,8,46,12,"body"],[47,12,46,16],[47,14,46,18,"isPost"],[47,20,46,24],[47,23,46,27,"data"],[47,27,46,31],[47,30,46,34],[47,34,46,38],[48,8,47,12,"headers"],[48,15,47,19],[49,8,48,12,"credentials"],[49,19,48,23],[49,21,48,25],[49,25,48,29],[49,26,48,30,"opts"],[49,30,48,34],[49,31,48,35,"withCredentials"],[49,46,48,50],[49,49,48,53],[49,58,48,62],[49,61,48,65],[50,6,49,8],[50,7,49,9],[50,8,49,10],[50,9,49,11,"then"],[50,13,49,15],[50,14,49,17,"res"],[50,17,49,20],[50,21,49,25],[51,8,50,12],[51,12,50,16,"_a"],[51,14,50,18],[52,8,51,12],[53,8,52,12],[53,9,52,13,"_a"],[53,11,52,15],[53,14,52,18],[53,18,52,22],[53,19,52,23,"socket"],[53,25,52,29],[53,26,52,30,"_cookieJar"],[53,36,52,40],[53,42,52,46],[53,46,52,50],[53,50,52,54,"_a"],[53,52,52,56],[53,57,52,61],[53,62,52,66],[53,63,52,67],[53,66,52,70],[53,71,52,75],[53,72,52,76],[53,75,52,79,"_a"],[53,77,52,81],[53,78,52,82,"parseCookies"],[53,90,52,94],[53,91,52,95,"res"],[53,94,52,98],[53,95,52,99,"headers"],[53,102,52,106],[53,103,52,107,"getSetCookie"],[53,115,52,119],[53,116,52,120],[53,117,52,121],[53,118,52,122],[54,8,53,12],[54,15,53,19,"res"],[54,18,53,22],[55,6,54,8],[55,7,54,9],[55,8,54,10],[56,4,55,4],[57,2,56,0],[58,2,56,1,"exports"],[58,9,56,1],[58,10,56,1,"Fetch"],[58,15,56,1],[58,18,56,1,"Fetch"],[58,23,56,1],[59,0,56,1],[59,3]],"functionMap":{"names":["<global>","Fetch","Fetch#doPoll","_fetch.then$argument_0","res.text.then$argument_0","_fetch.then._catch$argument_0","Fetch#doWrite","Fetch#_fetch","fetch.then$argument_0"],"mappings":"AAA;OCU;ICC;kBCE;4BCI,2BD;SDC;mBGC;SHE;KDC;IKC;kBHE;SGK;mBDC;SCE;KLC;IMC;gBCa;SDK;KNC;CDC"}},"type":"js/module"}]}