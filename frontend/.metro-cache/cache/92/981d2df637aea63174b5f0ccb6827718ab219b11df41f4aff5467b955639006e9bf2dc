{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"]}},{"name":"../transport.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":44,"index":44}}],"key":"q68AWRvh2qc0QUlp41HSOL9aMUA=","exportNames":["*"]}},{"name":"../globals.node.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":45},"end":{"line":2,"column":46,"index":91}}],"key":"RPWURBgga4vfm2ZRigByneogh6w=","exportNames":["*"]}},{"name":"engine.io-parser","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":92},"end":{"line":3,"column":89,"index":181}}],"key":"IB5HY76c7xC+tDEPCV8b/nK76DU=","exportNames":["*"]}},{"name":"debug","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":182},"end":{"line":4,"column":32,"index":214}}],"key":"Nx7LMnUOZdRc8E6QIb5nvmtJE+4=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.WT = void 0;\n  var _transport = require(_dependencyMap[1], \"../transport.js\");\n  var _globalsNode = require(_dependencyMap[2], \"../globals.node.js\");\n  var _engine = require(_dependencyMap[3], \"engine.io-parser\");\n  var _debug = _interopRequireDefault(require(_dependencyMap[4], \"debug\"));\n  // debug()\n  const debug = (0, _debug.default)(\"engine.io-client:webtransport\"); // debug()\n  /**\n   * WebTransport transport based on the built-in `WebTransport` object.\n   *\n   * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n   * @see https://caniuse.com/webtransport\n   */\n  class WT extends _transport.Transport {\n    get name() {\n      return \"webtransport\";\n    }\n    doOpen() {\n      try {\n        // @ts-ignore\n        this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n      } catch (err) {\n        return this.emitReserved(\"error\", err);\n      }\n      this._transport.closed.then(() => {\n        debug(\"transport closed gracefully\");\n        this.onClose();\n      }).catch(err => {\n        debug(\"transport closed due to %s\", err);\n        this.onError(\"webtransport error\", err);\n      });\n      // note: we could have used async/await, but that would require some additional polyfills\n      this._transport.ready.then(() => {\n        this._transport.createBidirectionalStream().then(stream => {\n          const decoderStream = (0, _engine.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n          const reader = stream.readable.pipeThrough(decoderStream).getReader();\n          const encoderStream = (0, _engine.createPacketEncoderStream)();\n          encoderStream.readable.pipeTo(stream.writable);\n          this._writer = encoderStream.writable.getWriter();\n          const read = () => {\n            reader.read().then(({\n              done,\n              value\n            }) => {\n              if (done) {\n                debug(\"session is closed\");\n                return;\n              }\n              debug(\"received chunk: %o\", value);\n              this.onPacket(value);\n              read();\n            }).catch(err => {\n              debug(\"an error occurred while reading: %s\", err);\n            });\n          };\n          read();\n          const packet = {\n            type: \"open\"\n          };\n          if (this.query.sid) {\n            packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n          }\n          this._writer.write(packet).then(() => this.onOpen());\n        });\n      });\n    }\n    write(packets) {\n      this.writable = false;\n      for (let i = 0; i < packets.length; i++) {\n        const packet = packets[i];\n        const lastPacket = i === packets.length - 1;\n        this._writer.write(packet).then(() => {\n          if (lastPacket) {\n            (0, _globalsNode.nextTick)(() => {\n              this.writable = true;\n              this.emitReserved(\"drain\");\n            }, this.setTimeoutFn);\n          }\n        });\n      }\n    }\n    doClose() {\n      var _a;\n      (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n  }\n  exports.WT = WT;\n});","lineCount":95,"map":[[7,2,1,0],[7,6,1,0,"_transport"],[7,16,1,0],[7,19,1,0,"require"],[7,26,1,0],[7,27,1,0,"_dependencyMap"],[7,41,1,0],[8,2,2,0],[8,6,2,0,"_globalsNode"],[8,18,2,0],[8,21,2,0,"require"],[8,28,2,0],[8,29,2,0,"_dependencyMap"],[8,43,2,0],[9,2,3,0],[9,6,3,0,"_engine"],[9,13,3,0],[9,16,3,0,"require"],[9,23,3,0],[9,24,3,0,"_dependencyMap"],[9,38,3,0],[10,2,4,0],[10,6,4,0,"_debug"],[10,12,4,0],[10,15,4,0,"_interopRequireDefault"],[10,37,4,0],[10,38,4,0,"require"],[10,45,4,0],[10,46,4,0,"_dependencyMap"],[10,60,4,0],[11,2,4,33],[12,2,5,0],[12,8,5,6,"debug"],[12,13,5,11],[12,16,5,14],[12,20,5,14,"debugModule"],[12,34,5,25],[12,36,5,26],[12,67,5,57],[12,68,5,58],[12,69,5,59],[12,70,5,60],[13,2,6,0],[14,0,7,0],[15,0,8,0],[16,0,9,0],[17,0,10,0],[18,0,11,0],[19,0,12,0],[20,0,13,0],[21,2,14,7],[21,8,14,13,"WT"],[21,10,14,15],[21,19,14,24,"Transport"],[21,39,14,33],[21,40,14,34],[22,4,15,4],[22,8,15,8,"name"],[22,12,15,12,"name"],[22,13,15,12],[22,15,15,15],[23,6,16,8],[23,13,16,15],[23,27,16,29],[24,4,17,4],[25,4,18,4,"doOpen"],[25,10,18,10,"doOpen"],[25,11,18,10],[25,13,18,13],[26,6,19,8],[26,10,19,12],[27,8,20,12],[28,8,21,12],[28,12,21,16],[28,13,21,17,"_transport"],[28,23,21,27],[28,26,21,30],[28,30,21,34,"WebTransport"],[28,42,21,46],[28,43,21,47],[28,47,21,51],[28,48,21,52,"createUri"],[28,57,21,61],[28,58,21,62],[28,65,21,69],[28,66,21,70],[28,68,21,72],[28,72,21,76],[28,73,21,77,"opts"],[28,77,21,81],[28,78,21,82,"transportOptions"],[28,94,21,98],[28,95,21,99],[28,99,21,103],[28,100,21,104,"name"],[28,104,21,108],[28,105,21,109],[28,106,21,110],[29,6,22,8],[29,7,22,9],[29,8,23,8],[29,15,23,15,"err"],[29,18,23,18],[29,20,23,20],[30,8,24,12],[30,15,24,19],[30,19,24,23],[30,20,24,24,"emitReserved"],[30,32,24,36],[30,33,24,37],[30,40,24,44],[30,42,24,46,"err"],[30,45,24,49],[30,46,24,50],[31,6,25,8],[32,6,26,8],[32,10,26,12],[32,11,26,13,"_transport"],[32,21,26,23],[32,22,26,24,"closed"],[32,28,26,30],[32,29,27,13,"then"],[32,33,27,17],[32,34,27,18],[32,40,27,24],[33,8,28,12,"debug"],[33,13,28,17],[33,14,28,18],[33,43,28,47],[33,44,28,48],[34,8,29,12],[34,12,29,16],[34,13,29,17,"onClose"],[34,20,29,24],[34,21,29,25],[34,22,29,26],[35,6,30,8],[35,7,30,9],[35,8,30,10],[35,9,31,13,"catch"],[35,14,31,18],[35,15,31,20,"err"],[35,18,31,23],[35,22,31,28],[36,8,32,12,"debug"],[36,13,32,17],[36,14,32,18],[36,42,32,46],[36,44,32,48,"err"],[36,47,32,51],[36,48,32,52],[37,8,33,12],[37,12,33,16],[37,13,33,17,"onError"],[37,20,33,24],[37,21,33,25],[37,41,33,45],[37,43,33,47,"err"],[37,46,33,50],[37,47,33,51],[38,6,34,8],[38,7,34,9],[38,8,34,10],[39,6,35,8],[40,6,36,8],[40,10,36,12],[40,11,36,13,"_transport"],[40,21,36,23],[40,22,36,24,"ready"],[40,27,36,29],[40,28,36,30,"then"],[40,32,36,34],[40,33,36,35],[40,39,36,41],[41,8,37,12],[41,12,37,16],[41,13,37,17,"_transport"],[41,23,37,27],[41,24,37,28,"createBidirectionalStream"],[41,49,37,53],[41,50,37,54],[41,51,37,55],[41,52,37,56,"then"],[41,56,37,60],[41,57,37,62,"stream"],[41,63,37,68],[41,67,37,73],[42,10,38,16],[42,16,38,22,"decoderStream"],[42,29,38,35],[42,32,38,38],[42,36,38,38,"createPacketDecoderStream"],[42,69,38,63],[42,71,38,64,"Number"],[42,77,38,70],[42,78,38,71,"MAX_SAFE_INTEGER"],[42,94,38,87],[42,96,38,89],[42,100,38,93],[42,101,38,94,"socket"],[42,107,38,100],[42,108,38,101,"binaryType"],[42,118,38,111],[42,119,38,112],[43,10,39,16],[43,16,39,22,"reader"],[43,22,39,28],[43,25,39,31,"stream"],[43,31,39,37],[43,32,39,38,"readable"],[43,40,39,46],[43,41,39,47,"pipeThrough"],[43,52,39,58],[43,53,39,59,"decoderStream"],[43,66,39,72],[43,67,39,73],[43,68,39,74,"getReader"],[43,77,39,83],[43,78,39,84],[43,79,39,85],[44,10,40,16],[44,16,40,22,"encoderStream"],[44,29,40,35],[44,32,40,38],[44,36,40,38,"createPacketEncoderStream"],[44,69,40,63],[44,71,40,64],[44,72,40,65],[45,10,41,16,"encoderStream"],[45,23,41,29],[45,24,41,30,"readable"],[45,32,41,38],[45,33,41,39,"pipeTo"],[45,39,41,45],[45,40,41,46,"stream"],[45,46,41,52],[45,47,41,53,"writable"],[45,55,41,61],[45,56,41,62],[46,10,42,16],[46,14,42,20],[46,15,42,21,"_writer"],[46,22,42,28],[46,25,42,31,"encoderStream"],[46,38,42,44],[46,39,42,45,"writable"],[46,47,42,53],[46,48,42,54,"getWriter"],[46,57,42,63],[46,58,42,64],[46,59,42,65],[47,10,43,16],[47,16,43,22,"read"],[47,20,43,26],[47,23,43,29,"read"],[47,24,43,29],[47,29,43,35],[48,12,44,20,"reader"],[48,18,44,26],[48,19,45,25,"read"],[48,23,45,29],[48,24,45,30],[48,25,45,31],[48,26,46,25,"then"],[48,30,46,29],[48,31,46,30],[48,32,46,31],[49,14,46,33,"done"],[49,18,46,37],[50,14,46,39,"value"],[51,12,46,45],[51,13,46,46],[51,18,46,51],[52,14,47,24],[52,18,47,28,"done"],[52,22,47,32],[52,24,47,34],[53,16,48,28,"debug"],[53,21,48,33],[53,22,48,34],[53,41,48,53],[53,42,48,54],[54,16,49,28],[55,14,50,24],[56,14,51,24,"debug"],[56,19,51,29],[56,20,51,30],[56,40,51,50],[56,42,51,52,"value"],[56,47,51,57],[56,48,51,58],[57,14,52,24],[57,18,52,28],[57,19,52,29,"onPacket"],[57,27,52,37],[57,28,52,38,"value"],[57,33,52,43],[57,34,52,44],[58,14,53,24,"read"],[58,18,53,28],[58,19,53,29],[58,20,53,30],[59,12,54,20],[59,13,54,21],[59,14,54,22],[59,15,55,25,"catch"],[59,20,55,30],[59,21,55,32,"err"],[59,24,55,35],[59,28,55,40],[60,14,56,24,"debug"],[60,19,56,29],[60,20,56,30],[60,57,56,67],[60,59,56,69,"err"],[60,62,56,72],[60,63,56,73],[61,12,57,20],[61,13,57,21],[61,14,57,22],[62,10,58,16],[62,11,58,17],[63,10,59,16,"read"],[63,14,59,20],[63,15,59,21],[63,16,59,22],[64,10,60,16],[64,16,60,22,"packet"],[64,22,60,28],[64,25,60,31],[65,12,60,33,"type"],[65,16,60,37],[65,18,60,39],[66,10,60,46],[66,11,60,47],[67,10,61,16],[67,14,61,20],[67,18,61,24],[67,19,61,25,"query"],[67,24,61,30],[67,25,61,31,"sid"],[67,28,61,34],[67,30,61,36],[68,12,62,20,"packet"],[68,18,62,26],[68,19,62,27,"data"],[68,23,62,31],[68,26,62,34],[68,37,62,45],[68,41,62,49],[68,42,62,50,"query"],[68,47,62,55],[68,48,62,56,"sid"],[68,51,62,59],[68,55,62,63],[69,10,63,16],[70,10,64,16],[70,14,64,20],[70,15,64,21,"_writer"],[70,22,64,28],[70,23,64,29,"write"],[70,28,64,34],[70,29,64,35,"packet"],[70,35,64,41],[70,36,64,42],[70,37,64,43,"then"],[70,41,64,47],[70,42,64,48],[70,48,64,54],[70,52,64,58],[70,53,64,59,"onOpen"],[70,59,64,65],[70,60,64,66],[70,61,64,67],[70,62,64,68],[71,8,65,12],[71,9,65,13],[71,10,65,14],[72,6,66,8],[72,7,66,9],[72,8,66,10],[73,4,67,4],[74,4,68,4,"write"],[74,9,68,9,"write"],[74,10,68,10,"packets"],[74,17,68,17],[74,19,68,19],[75,6,69,8],[75,10,69,12],[75,11,69,13,"writable"],[75,19,69,21],[75,22,69,24],[75,27,69,29],[76,6,70,8],[76,11,70,13],[76,15,70,17,"i"],[76,16,70,18],[76,19,70,21],[76,20,70,22],[76,22,70,24,"i"],[76,23,70,25],[76,26,70,28,"packets"],[76,33,70,35],[76,34,70,36,"length"],[76,40,70,42],[76,42,70,44,"i"],[76,43,70,45],[76,45,70,47],[76,47,70,49],[77,8,71,12],[77,14,71,18,"packet"],[77,20,71,24],[77,23,71,27,"packets"],[77,30,71,34],[77,31,71,35,"i"],[77,32,71,36],[77,33,71,37],[78,8,72,12],[78,14,72,18,"lastPacket"],[78,24,72,28],[78,27,72,31,"i"],[78,28,72,32],[78,33,72,37,"packets"],[78,40,72,44],[78,41,72,45,"length"],[78,47,72,51],[78,50,72,54],[78,51,72,55],[79,8,73,12],[79,12,73,16],[79,13,73,17,"_writer"],[79,20,73,24],[79,21,73,25,"write"],[79,26,73,30],[79,27,73,31,"packet"],[79,33,73,37],[79,34,73,38],[79,35,73,39,"then"],[79,39,73,43],[79,40,73,44],[79,46,73,50],[80,10,74,16],[80,14,74,20,"lastPacket"],[80,24,74,30],[80,26,74,32],[81,12,75,20],[81,16,75,20,"nextTick"],[81,37,75,28],[81,39,75,29],[81,45,75,35],[82,14,76,24],[82,18,76,28],[82,19,76,29,"writable"],[82,27,76,37],[82,30,76,40],[82,34,76,44],[83,14,77,24],[83,18,77,28],[83,19,77,29,"emitReserved"],[83,31,77,41],[83,32,77,42],[83,39,77,49],[83,40,77,50],[84,12,78,20],[84,13,78,21],[84,15,78,23],[84,19,78,27],[84,20,78,28,"setTimeoutFn"],[84,32,78,40],[84,33,78,41],[85,10,79,16],[86,8,80,12],[86,9,80,13],[86,10,80,14],[87,6,81,8],[88,4,82,4],[89,4,83,4,"doClose"],[89,11,83,11,"doClose"],[89,12,83,11],[89,14,83,14],[90,6,84,8],[90,10,84,12,"_a"],[90,12,84,14],[91,6,85,8],[91,7,85,9,"_a"],[91,9,85,11],[91,12,85,14],[91,16,85,18],[91,17,85,19,"_transport"],[91,27,85,29],[91,33,85,35],[91,37,85,39],[91,41,85,43,"_a"],[91,43,85,45],[91,48,85,50],[91,53,85,55],[91,54,85,56],[91,57,85,59],[91,62,85,64],[91,63,85,65],[91,66,85,68,"_a"],[91,68,85,70],[91,69,85,71,"close"],[91,74,85,76],[91,75,85,77],[91,76,85,78],[92,4,86,4],[93,2,87,0],[94,2,87,1,"exports"],[94,9,87,1],[94,10,87,1,"WT"],[94,12,87,1],[94,15,87,1,"WT"],[94,17,87,1],[95,0,87,1],[95,3]],"functionMap":{"names":["<global>","WT","WT#get__name","WT#doOpen","_transport.closed.then$argument_0","_transport.closed.then._catch$argument_0","_transport.ready.then$argument_0","_transport.createBidirectionalStream.then$argument_0","read","reader.read.then$argument_0","reader.read.then._catch$argument_0","_writer.write.then$argument_0","WT#write","nextTick$argument_0","WT#doClose"],"mappings":"AAA;OCa;ICC;KDE;IEC;kBCS;SDG;mBEC;SFG;mCGE;6DCC;6BCM;8BCG;qBDQ;+BEC;qBFE;iBDC;gDIM,mBJ;aDC;SHC;KFC;IWC;4CDK;6BEE;qBFG;aCE;KXE;IaC;KbG;CDC"}},"type":"js/module"}]}